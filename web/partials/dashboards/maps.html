        <!-- Maps Dashboard (2D/3D Map Visualization) -->
        <div id="map-container" class="dashboard-view" role="tabpanel" aria-labelledby="tab-maps" tabindex="-1">
            <div id="view-toggle-control" role="group" aria-label="View mode">
                <button
                    id="view-mode-2d"
                    class="view-mode-btn active"
                    aria-pressed="true"
                    title="2D Map View">
                    üó∫Ô∏è 2D Map
                </button>
                <button
                    id="view-mode-3d"
                    class="view-mode-btn"
                    aria-pressed="false"
                    title="3D Globe View">
                    üåç 3D Globe
                </button>
            </div>

            <div id="map" role="application" aria-label="Interactive geographic map">
                <div id="webgl-not-supported" class="error-message" style="display: none;">
                    <h2>WebGL Not Supported</h2>
                    <p>Your browser doesn't support WebGL, which is required for the interactive map visualization.</p>
                    <p>Please try one of these modern browsers:</p>
                    <ul>
                        <li>Google Chrome (version 90+)</li>
                        <li>Mozilla Firefox (version 88+)</li>
                        <li>Microsoft Edge (version 90+)</li>
                        <li>Safari (version 14+)</li>
                    </ul>
                    <p>You can still view analytics charts in the Analytics tab.</p>
                </div>
                <div id="map-mode-control" role="group" aria-label="Map visualization mode">
                    <button
                        id="map-mode-points"
                        class="map-mode-btn"
                        aria-pressed="false"
                        title="Show individual points">
                        Points
                    </button>
                    <button
                        id="map-mode-clusters"
                        class="map-mode-btn"
                        aria-pressed="false"
                        title="Show clustered locations">
                        Clusters
                    </button>
                    <button
                        id="map-mode-heatmap"
                        class="map-mode-btn active"
                        aria-pressed="true"
                        title="Show heatmap density">
                        Heatmap
                    </button>
                    <button
                        id="map-mode-hexagons"
                        class="map-mode-btn"
                        data-mode="hexagons"
                        aria-pressed="false"
                        aria-label="Show hexagon density (H3 grid)"
                        title="Show H3 hexagon grid density">
                        Hexagons
                    </button>
                </div>
                <!-- H3 Hexagon Resolution Control -->
                <div id="hexagon-resolution-control" class="hexagon-resolution-control" style="display: none;">
                    <label class="filter-label" for="hexagon-resolution">Resolution</label>
                    <select id="hexagon-resolution" data-control="h3-resolution" class="h3-resolution-control">
                        <option value="6">Country (Low)</option>
                        <option value="7" selected>City (Medium)</option>
                        <option value="8">Neighborhood (High)</option>
                    </select>
                </div>
                <!-- Arc Overlay Control -->
                <div id="arc-control" class="arc-control" role="group" aria-label="Connection arc overlay">
                    <button
                        id="arc-toggle"
                        class="arc-toggle-btn"
                        data-control="arcs"
                        aria-pressed="false"
                        aria-label="Show server-to-user connection arcs"
                        title="Show connection arcs from server to users">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                            <path d="M3 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm12 12a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM2 3c.5 0 1 .2 1.4.5C5 5 6 7 8 8c2 1 5 2 5.6 2.5.4.3.4.5.4 1"/>
                            <path d="M2 3Q6 5 8 8Q10 11 14 13" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                        </svg>
                        Arcs
                    </button>
                </div>
                <div id="loading" role="status" aria-live="polite">Loading...</div>
            </div>

            <div id="globe"
                role="application"
                aria-label="Interactive 3D globe visualization showing playback locations worldwide"
                aria-describedby="globe-description globe-keyboard-help"
                aria-busy="false"
                tabindex="0"
                style="display: none;">
                <!-- Screen reader description -->
                <div id="globe-description" class="sr-only">
                    Interactive 3D globe displaying media playback locations. Use arrow keys to pan, plus and minus to zoom, R to reset view. Tab to navigate controls.
                </div>
                <!-- Keyboard help (hidden but available for screen readers) -->
                <div id="globe-keyboard-help" class="sr-only">
                    Keyboard shortcuts: Arrow keys to pan the view. Plus or equals key to zoom in. Minus key to zoom out. R to reset view. Escape to exit focus.
                </div>
                <!-- Live region for announcements -->
                <div id="globe-announcer" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>
                <!-- Data summary for screen readers -->
                <div id="globe-data-summary" role="status" aria-live="polite" class="sr-only"></div>

                <div id="globe-not-supported" class="error-message" role="alert" style="display: none;">
                    <h2>WebGL Required</h2>
                    <p>The 3D Globe requires WebGL support, which is not available in your browser.</p>
                    <p>Please switch to 2D Map view or upgrade to a modern browser:</p>
                    <ul>
                        <li>Google Chrome (version 90+)</li>
                        <li>Mozilla Firefox (version 88+)</li>
                        <li>Microsoft Edge (version 90+)</li>
                        <li>Safari (version 14+)</li>
                    </ul>
                </div>
                <div id="globe-controls" role="toolbar" aria-label="Globe view controls">
                    <button
                        id="globe-auto-rotate"
                        class="globe-control-btn"
                        title="Toggle auto-rotation (press Space to toggle)"
                        aria-label="Toggle auto-rotation"
                        aria-pressed="false">
                        <span aria-hidden="true">üîÑ</span> Auto-Rotate
                    </button>
                    <button
                        id="globe-reset-view"
                        class="globe-control-btn"
                        title="Reset camera view (press R)"
                        aria-label="Reset camera view to default position">
                        <span aria-hidden="true">üéØ</span> Reset View
                    </button>
                </div>
                <div id="globe-loading" role="status" aria-live="polite" aria-busy="true">Loading globe...</div>
            </div>

            <!-- ROOT CAUSE FIX: Moved fullscreen toggle outside #map and #globe containers -->
            <!-- WHY: When switching to globe view, #map is hidden (display:none), which also hid -->
            <!-- the fullscreen toggle inside it. Moving it to #map-container level ensures visibility -->
            <!-- in both 2D and 3D views. (E2E test: 30-fullscreen-mode.spec.ts:183) -->
            <button
                id="fullscreen-toggle"
                class="fullscreen-toggle-btn"
                aria-label="Enter fullscreen mode"
                title="Toggle fullscreen mode">
                <span class="fullscreen-icon" aria-hidden="true">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 6V2h4M16 6V2h-4M2 12v4h4M16 12v4h-4"/>
                    </svg>
                </span>
            </button>

            <div id="timeline-container" role="region" aria-label="Playback timeline">
                <div id="timeline-header">
                    <div id="timeline-info">
                        <span id="timeline-time">--:--:--</span>
                        <span id="timeline-count">0 playbacks</span>
                    </div>
                    <div id="timeline-controls">
                        <button id="timeline-reset" aria-label="Reset timeline" title="Reset to start">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                            </svg>
                        </button>
                        <button id="timeline-play-pause" aria-label="Play timeline" title="Play/Pause">
                            <svg id="timeline-play-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445z"/>
                            </svg>
                            <svg id="timeline-pause-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="display:none;">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M5 6.25a1.25 1.25 0 1 1 2.5 0v3.5a1.25 1.25 0 1 1-2.5 0v-3.5zm3.5 0a1.25 1.25 0 1 1 2.5 0v3.5a1.25 1.25 0 1 1-2.5 0v-3.5z"/>
                            </svg>
                        </button>
                        <select id="timeline-speed" aria-label="Playback speed">
                            <option value="1" selected>1x</option>
                            <option value="2">2x</option>
                            <option value="5">5x</option>
                            <option value="10">10x</option>
                        </select>
                        <select id="timeline-interval" aria-label="Time interval">
                            <option value="hourly" selected>Hourly</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>
                </div>
                <div id="timeline-scrubber">
                    <input
                        type="range"
                        id="timeline-slider"
                        min="0"
                        max="100"
                        value="0"
                        step="0.1"
                        aria-label="Timeline scrubber"
                    />
                </div>
            </div>
        </div>

