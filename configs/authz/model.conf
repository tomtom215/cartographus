# Casbin RBAC Model with Resource Hierarchy
# Documentation: https://casbin.org/docs/syntax-for-models
# ADR-0015: Zero Trust Authentication & Authorization

[request_definition]
# r = subject, object, action
# subject: user ID or role
# object: resource path (e.g., /api/maps/123)
# action: HTTP method or permission (e.g., GET, POST, read, write)
r = sub, obj, act

[policy_definition]
# p = subject, object, action
p = sub, obj, act

[role_definition]
# g = user, role
# Supports role hierarchy: user -> role -> parent_role
g = _, _

[policy_effect]
# Allow if any matching policy allows
e = some(where (p.eft == allow))

[matchers]
# Match if:
# 1. Object matches exactly OR matches with keyMatch2 (supports :id patterns)
# 2. Action matches exactly OR policy action is wildcard (*)
# 3. Subject has the role (direct or inherited)
# IMPORTANT: Simple comparisons BEFORE g() function for performance
m = (r.obj == p.obj || keyMatch2(r.obj, p.obj)) && (r.act == p.act || p.act == "*") && g(r.sub, p.sub)
